---
- name: Special Project Service - Deploy/Repair DNS
  hosts: localhost
  connection: local
  gather_facts: false
  collections:
    - redhat.openshift

  vars:
    namespace: "{{ namespace | default('special-payment-project') }}"
    external_service_name: "{{ external_service_name | default('card-gateway-dns') }}"
    correct_external_name: "{{ correct_external_name | default('card-gateway-sandbox.payments-provider-sim.svc.cluster.local') }}"

  tasks:
    - name: Ensure ExternalName Service points to correct upstream
      redhat.openshift.k8s:
        state: present
        merge_type: strategic-merge
        definition:
          apiVersion: v1
          kind: Service
          metadata:
            name: "{{ external_service_name }}"
            namespace: "{{ namespace }}"
          spec:
            externalName: "{{ correct_external_name }}"




