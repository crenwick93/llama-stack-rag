---
# All CAAC objects live here. apply.yml loads this file and runs dispatch.

# Controller custom credential types
controller_credential_types:
  - name: "ServiceNow Credential"
    description: "Description of your credential type"
    kind: "cloud"
    inputs:
      fields:
        - id: SN_HOST
          type: string
          label: Snow Instance
        - id: SN_USERNAME
          type: string
          label: Username
        - id: SN_PASSWORD
          type: string
          label: Password
          secret: true
      required:
        - SN_HOST
        - SN_USERNAME
        - SN_PASSWORD
    injectors:
      env:
        SN_HOST: !unsafe "{{ SN_HOST }}"
        SN_USERNAME: !unsafe "{{ SN_USERNAME }}"
        SN_PASSWORD: !unsafe "{{ SN_PASSWORD }}"

# EDA custom credential types
eda_credential_types:
  - name: "ServiceNow Credential"
    description: "Description of your credential type"
    kind: "cloud"
    inputs:
      fields:
        - id: SN_HOST
          type: string
          label: Snow Instance
        - id: SN_USERNAME
          type: string
          label: Username
        - id: SN_PASSWORD
          type: string
          label: Password
          secret: true
      required:
        - SN_HOST
        - SN_USERNAME
        - SN_PASSWORD
    injectors:
      env:
        SN_HOST: !unsafe "{{ SN_HOST }}"
        SN_USERNAME: !unsafe "{{ SN_USERNAME }}"
        SN_PASSWORD: !unsafe "{{ SN_PASSWORD }}"

# Controller projects
controller_projects:
  - name: "llama-stack-rag"
    description: "Demo project for Llama Stack RAG"
    organization: "{{ aap_org }}"
    scm_type: "git"
    scm_url: "https://github.com/crenwick93/llama-stack-rag.git"
    scm_branch: "main"
    scm_update_on_launch: true

# EDA projects
eda_projects:
  - name: "llama-stack-rag"
    description: "Demo project for Llama Stack RAG"
    organization: "{{ aap_org }}"
    scm_type: "git"
    scm_url: "https://github.com/crenwick93/llama-stack-rag.git"
    scm_branch: "main"
    scm_update_on_launch: true
    sync: true

# Controller credentials (ServiceNow, using the custom type)
controller_credentials:
  - name: "ServiceNow ITSM"
    description: "ServiceNow ITSM credential"
    organization: "{{ aap_org }}"
    credential_type: "ServiceNow Credential"
    inputs:
      SN_HOST: "{{ sn_instance }}"
      SN_USERNAME: "{{ sn_username }}"
      SN_PASSWORD: "{{ sn_password }}"

# EDA credentials (ServiceNow, using the custom type)
eda_credentials:
  - name: "ServiceNow ITSM"
    description: "ServiceNow ITSM credential"
    organization: "{{ aap_org }}"
    credential_type: "ServiceNow Credential"
    inputs:
      SN_HOST: "{{ sn_instance }}"
      SN_USERNAME: "{{ sn_username }}"
      SN_PASSWORD: "{{ sn_password }}"
  - name: "AAP Controller"
    description: "Token credential for connecting EDA to Controller"
    organization: "{{ aap_org }}"
    credential_type: "Red Hat Ansible Automation Platform"
    inputs:
      host: "{{ (aap_hostname | regex_replace('/+$','')) ~ '/api/controller/' }}"
      oauth_token: "{{ aap_token }}"
      verify_ssl: "{{ aap_validate_certs }}"

# EDA Decision Environments
eda_decision_environments:
  - name: "snow-de"
    description: "Decision Environment with ServiceNow collection"
    organization: "{{ aap_org }}"
    image_url: "quay.io/crenwick93/snow-de:latest"
    # If your registry requires auth, add:
    # credential: "<registry-credential-name>"

# EDA rulebook activations
eda_rulebook_activations:
  - name: "snow-incidents"
    description: "Monitor and print ServiceNow incident events"
    organization: "{{ aap_org }}"
    project: "llama-stack-rag"
    rulebook: "snow_incidents.yml"
    decision_environment: "snow-de"
    credentials:
      - "ServiceNow ITSM"
      - "AAP Controller"
    enabled: true


